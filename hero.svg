(function(){
  const path=(location.pathname.split('/').pop()||'index.html').toLowerCase();
  document.querySelectorAll('.nav-links a').forEach(a=>{
    if((a.getAttribute('href')||'').toLowerCase()===path) a.classList.add('active');
  });
  const canvas=document.getElementById('heroParticles'); if(!canvas) return;
  const ctx=canvas.getContext('2d'); let w=0,h=0,dpr=1,parts=[]; const MAX=70;
  const rand=(a,b)=>Math.random()*(b-a)+a;
  function resize(){dpr=Math.min(2,window.devicePixelRatio||1);const r=canvas.getBoundingClientRect();w=Math.floor(r.width);h=Math.floor(r.height);
    canvas.width=Math.floor(w*dpr);canvas.height=Math.floor(h*dpr);ctx.setTransform(dpr,0,0,dpr,0,0);}
  function seed(){parts=[];for(let i=0;i<MAX;i++){parts.push({x:rand(0,w),y:rand(0,h),r:rand(.6,2.2),vx:rand(-.22,.22),vy:rand(-.10,.26),a:rand(.12,.55)})}}
  function loop(){
    ctx.clearRect(0,0,w,h);
    const g=ctx.createRadialGradient(w*.25,h*.2,60,w*.25,h*.2,Math.max(w,h));
    g.addColorStop(0,'rgba(212,175,55,0.10)');g.addColorStop(.5,'rgba(184,137,23,0.06)');g.addColorStop(1,'rgba(0,0,0,0.0)');
    ctx.fillStyle=g;ctx.fillRect(0,0,w,h);
    for(const p of parts){
      ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fillStyle=`rgba(212,175,55,${p.a})`;ctx.fill();
      p.x+=p.vx;p.y+=p.vy; if(p.x<-10)p.x=w+10; if(p.x>w+10)p.x=-10; if(p.y<-10)p.y=h+10; if(p.y>h+10)p.y=-10;
    }
    for(let i=0;i<parts.length;i++)for(let j=i+1;j<parts.length;j++){
      const a=parts[i],b=parts[j];const dx=a.x-b.x,dy=a.y-b.y;const dist=Math.sqrt(dx*dx+dy*dy);
      if(dist<120){const alpha=(1-dist/120)*0.10;ctx.strokeStyle=`rgba(212,175,55,${alpha})`;ctx.lineWidth=1;
        ctx.beginPath();ctx.moveTo(a.x,a.y);ctx.lineTo(b.x,b.y);ctx.stroke();}
    }
    requestAnimationFrame(loop);
  }
  resize();seed();loop();window.addEventListener('resize',()=>{resize();seed();},{passive:true});
})();